<!doctype html>
<html lang="en">
<head>
  <title>Reese’s TV</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0e1a" />
  <link rel="icon" href="img/favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="img/favicon.png" />
  <link rel="preload" href="img/logo-full.png" as="image" />
  <link rel="stylesheet" href="styles.css" />
  <script defer src="drive.js"></script>
  <script defer src="app.js"></script>
  <meta name="description" content="Reese’s TV — a sleek, Disney+-style streaming library that auto-indexes your Google Drive shows." />
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body data-page="home">
  <header class="topbar">
    <a class="brand" href="index.html"><img src="img/logo-full.png" alt="Logo" height="28"/></a>
    <nav class="nav"><a href="browse.html">Browse</a><a href="library.html">Library</a></nav>
    <div style="margin-left:auto"></div>
  </header>
  <main id="home-root">
    <section id="home-hero" class="hero"><div class="content"><h1 class="title">Loading…</h1></div></section>
    <section class="row">Top Picks</section>
    <div id="row-top" class="scroller"></div>
    <section class="row">Trending</section>
    <div id="row-trend" class="scroller"></div>
    <section class="row">Because you watched</section>
    <div id="row-because" class="scroller"></div>
  </main>

<script>
let tokenClient;
window.onload = () => {
  tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: '465014084113-csjk55ee9mmq7kbb8a33b713q79gbt4q.apps.googleusercontent.com',
    scope: 'https://www.googleapis.com/auth/drive.readonly',
    callback: (resp) => {
      if(resp.error){ console.error(resp); return; }
      const config = {
        accessToken: resp.access_token,
        folders: ["1uaF2R_oJePLn2BeVbOkKc1y9-NW5MYAH"]
      };
      Drive.loadFromConfig(config).then(data => {
        window.state = window.state||{};
        state.data = data;
        renderHome?.(data);
      });
    }
  });
};
function signInAndGetToken(){ tokenClient.requestAccessToken({prompt:'consent'}); }
</script>
<button onclick="signInAndGetToken()" style="position:fixed;top:8px;right:8px;z-index:2000">Connect Google Drive</button>

<script>
window.DriveBoot = async function(accessToken){
  const cfg = await fetch("config.json").then(r=>r.json()).catch(()=>({}));
  const folders = cfg.folders || [];
  const config = accessToken ? { accessToken, folders } : cfg;
  const data = await Drive.loadFromConfig(config);
  window.state = window.state || {};
  state.data = data;
  if (document.body.dataset.page === "home") renderHome?.(data);
  if (document.body.dataset.page === "browse") renderBrowse?.(data);
  if (document.body.dataset.page === "library") renderLibrary?.(data);
  if (document.body.dataset.page === "show") renderShow?.(data);
  if (document.body.dataset.page === "watch") renderWatch?.(data);
};
</script>
</body>
</html>